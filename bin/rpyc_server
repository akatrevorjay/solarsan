#!/usr/bin/env python

from solarsan.core import logger
#from solarsan import conf
from solarsan.cluster.models import Peer
from solarsan.rpc.server import StorageService
from rpyc.utils.server import ThreadedServer
import rpyc


def main():
    local = Peer.get_local()
    cluster_iface_bcast = local.cluster_nic.broadcast
    # Allow all public attrs, because exposed_ is stupid and should be a
    # fucking decorator.
    t = ThreadedServer(StorageService, port=18861,
                       registrar=rpyc.utils.registry.UDPRegistryClient(ip=cluster_iface_bcast, logger=logger),
                       auto_register=True, logger=logger)
    t.start()


if __name__ == '__main__':
    main()
